<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="Track your cold calling leads, conversions, and achieve your sales goals with team collaboration">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>CallTrack Pro - Cold Calling CRM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      margin: 0; 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
    .glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .progress-ring { transform: rotate(-90deg); }
    .progress-ring-circle { transition: stroke-dashoffset 0.5s ease; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Icons
    const Phone = ({className = "w-6 h-6"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>;
    const Users = ({className = "w-6 h-6"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>;
    const TrendingUp = ({className = "w-6 h-6"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>;
    const Plus = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
    const Search = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>;
    const Edit2 = ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
    const Trash2 = ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
    const CheckCircle = ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
    const XCircle = ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
    const Clock = ({className = "w-4 h-4"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
    const Download = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>;
    const Crown = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>;
    const UserPlus = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" /></svg>;
    const FileText = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>;
    const Sparkles = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>;
    const Zap = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>;
    const Target = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
    const Trophy = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>;
    const LogOut = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>;
    const Mail = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>;
    const Copy = ({className = "w-5 h-5"}) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;

    const generateGroupCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();

    const ACHIEVEMENTS = [
      { id: 'first_call', title: 'First Call', desc: 'Make your first call', goal: 1, badge: 'ðŸŽ¯' },
      { id: 'calls_10', title: 'Dialer', desc: 'Make 10 calls', goal: 10, badge: 'ðŸ“ž' },
      { id: 'calls_50', title: 'Call Master', desc: 'Make 50 calls', goal: 50, badge: 'ðŸ†' },
      { id: 'calls_100', title: 'Century Club', desc: 'Make 100 calls', goal: 100, badge: 'ðŸ’¯' },
      { id: 'first_conversion', title: 'First Win', desc: 'Convert your first lead', goal: 1, badge: 'ðŸŽ‰' },
      { id: 'conversions_5', title: 'Deal Maker', desc: 'Convert 5 leads', goal: 5, badge: 'ðŸ’¼' },
      { id: 'conversions_10', title: 'Sales Pro', desc: 'Convert 10 leads', goal: 10, badge: 'ðŸ‘‘' },
    ];

    function CallTrackPro() {
      const [user, setUser] = useState(null);
      const [showAuth, setShowAuth] = useState(true);
      const [authMode, setAuthMode] = useState('signin');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [leads, setLeads] = useState([]);
      const [showAddForm, setShowAddForm] = useState(false);
      const [editingLead, setEditingLead] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [filterStatus, setFilterStatus] = useState('all');
      const [showUpgrade, setShowUpgrade] = useState(false);
      const [showAchievements, setShowAchievements] = useState(false);
      const [newAchievement, setNewAchievement] = useState(null);
      const [showGroupModal, setShowGroupModal] = useState(false);
      const [groupCode, setGroupCode] = useState('');
      const [copiedCode, setCopiedCode] = useState(false);
      const [formData, setFormData] = useState({
        businessName: '', contactName: '', phone: '', email: '', status: 'not-called', notes: '', addedBy: ''
      });

      useEffect(() => {
        const savedUser = localStorage.getItem('crm-current-user');
        if (savedUser) {
          const userData = JSON.parse(savedUser);
          setUser(userData);
          setShowAuth(false);
          loadUserData(userData.id);
        }
      }, []);

      const loadUserData = (userId) => {
        const user = getUserById(userId);
        if (user) {
          if (user.groupId) {
            const group = getGroup(user.groupId);
            if (group) setLeads(group.leads || []);
          } else {
            setLeads(user.leads || []);
          }
        }
      };

      const saveUserData = () => {
        if (!user) return;
        const allUsers = JSON.parse(localStorage.getItem('crm-all-users') || '[]');
        if (user.groupId) {
          const allGroups = JSON.parse(localStorage.getItem('crm-groups') || '[]');
          const groupIndex = allGroups.findIndex(g => g.id === user.groupId);
          if (groupIndex !== -1) {
            allGroups[groupIndex].leads = leads;
            localStorage.setItem('crm-groups', JSON.stringify(allGroups));
          }
        } else {
          const userIndex = allUsers.findIndex(u => u.id === user.id);
          if (userIndex !== -1) {
            allUsers[userIndex].leads = leads;
            localStorage.setItem('crm-all-users', JSON.stringify(allUsers));
          }
        }
      };

      useEffect(() => { if (user) saveUserData(); }, [leads]);

      const getUserById = (id) => {
        const allUsers = JSON.parse(localStorage.getItem('crm-all-users') || '[]');
        return allUsers.find(u => u.id === id);
      };

      const getGroup = (groupId) => {
        const allGroups = JSON.parse(localStorage.getItem('crm-groups') || '[]');
        return allGroups.find(g => g.id === groupId);
      };

      const handleAuth = () => {
        if (!email || !password) return alert('Please enter email and password');
        const allUsers = JSON.parse(localStorage.getItem('crm-all-users') || '[]');

        if (authMode === 'signup') {
          if (allUsers.find(u => u.email === email)) return alert('Email already exists. Please sign in.');
          const newUser = {
            id: Date.now().toString(), email, password, name: email.split('@')[0],
            isPro: false, groupId: null, joinedDate: new Date().toISOString(),
            achievements: [], leads: []
          };
          allUsers.push(newUser);
          localStorage.setItem('crm-all-users', JSON.stringify(allUsers));
          localStorage.setItem('crm-current-user', JSON.stringify(newUser));
          setUser(newUser);
          setShowAuth(false);
          setLeads([]);
        } else {
          const foundUser = allUsers.find(u => u.email === email && u.password === password);
          if (foundUser) {
            localStorage.setItem('crm-current-user', JSON.stringify(foundUser));
            setUser(foundUser);
            setShowAuth(false);
            loadUserData(foundUser.id);
          } else {
            alert('Invalid email or password');
          }
        }
      };

      const handleLogout = () => {
        localStorage.removeItem('crm-current-user');
        setUser(null);
        setShowAuth(true);
        setLeads([]);
      };

      const updateUserInStorage = (updatedUser) => {
        const allUsers = JSON.parse(localStorage.getItem('crm-all-users') || '[]');
        const userIndex = allUsers.findIndex(u => u.id === updatedUser.id);
        if (userIndex !== -1) {
          allUsers[userIndex] = updatedUser;
          localStorage.setItem('crm-all-users', JSON.stringify(allUsers));
          localStorage.setItem('crm-current-user', JSON.stringify(updatedUser));
        }
      };

      const createGroup = () => {
        if (!user?.isPro) return setShowUpgrade(true);
        const code = generateGroupCode();
        const allGroups = JSON.parse(localStorage.getItem('crm-groups') || '[]');
        const newGroup = {
          id: Date.now().toString(), code, ownerId: user.id,
          name: `${user.name}'s Team`,
          members: [{ id: user.id, email: user.email, name: user.name, role: 'owner' }],
          leads: [...leads], createdAt: new Date().toISOString()
        };
        allGroups.push(newGroup);
        localStorage.setItem('crm-groups', JSON.stringify(allGroups));
        const updatedUser = { ...user, groupId: newGroup.id };
        setUser(updatedUser);
        updateUserInStorage(updatedUser);
        setGroupCode(code);
        setShowGroupModal(true);
      };

      const joinGroup = () => {
        if (!user?.isPro) return setShowUpgrade(true);
        const code = prompt('Enter group code:');
        if (!code) return;
        const allGroups = JSON.parse(localStorage.getItem('crm-groups') || '[]');
        const group = allGroups.find(g => g.code.toUpperCase() === code.toUpperCase());
        if (!group) return alert('Invalid group code');
        group.members.push({ id: user.id, email: user.email, name: user.name, role: 'member' });
        localStorage.setItem('crm-groups', JSON.stringify(allGroups));
        const updatedUser = { ...user, groupId: group.id };
        setUser(updatedUser);
        updateUserInStorage(updatedUser);
        setLeads(group.leads || []);
        alert(`Joined ${group.name}!`);
      };

      const leaveGroup = () => {
        if (!confirm('Leave this group?')) return;
        const allGroups = JSON.parse(localStorage.getItem('crm-groups') || '[]');
        const groupIndex = allGroups.findIndex(g => g.id === user.groupId);
        if (groupIndex !== -1) {
          allGroups[groupIndex].members = allGroups[groupIndex].members.filter(m => m.id !== user.id);
          localStorage.setItem('crm-groups', JSON.stringify(allGroups));
        }
        const savedUser = getUserById(user.id);
        const updatedUser = { ...user, groupId: null };
        setUser(updatedUser);
        updateUserInStorage(updatedUser);
        setLeads(savedUser.leads || []);
      };

      const copyGroupCode = () => {
        const group = getGroup(user.groupId);
        if (group) {
          navigator.clipboard.writeText(group.code);
          setCopiedCode(true);
          setTimeout(() => setCopiedCode(false), 2000);
        }
      };

      const checkAchievements = () => {
        if (!user) return;
        const totalCalls = leads.filter(l => l.status !== 'not-called').length;
        const totalConversions = leads.filter(l => l.status === 'converted').length;
        const userAchievements = user.achievements || [];
        const newAchievements = [];
        if (totalCalls >= 1 && !userAchievements.includes('first_call')) newAchievements.push('first_call');
        if (totalCalls >= 10 && !userAchievements.includes('calls_10')) newAchievements.push('calls_10');
        if (totalCalls >= 50 && !userAchievements.includes('calls_50')) newAchievements.push('calls_50');
        if (totalCalls >= 100 && !userAchievements.includes('calls_100')) newAchievements.push('calls_100');
        if (totalConversions >= 1 && !userAchievements.includes('first_conversion')) newAchievements.push('first_conversion');
        if (totalConversions >= 5 && !userAchievements.includes('conversions_5')) newAchievements.push('conversions_5');
        if (totalConversions >= 10 && !userAchievements.includes('conversions_10')) newAchievements.push('conversions_10');
        if (newAchievements.length > 0) {
          const updatedUser = { ...user, achievements: [...userAchievements, ...newAchievements] };
          setUser(updatedUser);
          updateUserInStorage(updatedUser);
          const achievement = ACHIEVEMENTS.find(a => a.id === newAchievements[0]);
          setNewAchievement(achievement);
          setTimeout(() => setNewAchievement(null), 5000);
        }
      };

      useEffect(() => { checkAchievements(); }, [leads]);

      const getGroupStats = () => {
        if (!user?.groupId) return null;
        const group = getGroup(user.groupId);
        if (!group) return null;
        const groupLeads = group.leads || [];
        return {
          totalMembers: group.members.length,
          totalLeads: groupLeads.length,
          totalCalls: groupLeads.filter(l => l.status !== 'not-called').length,
          totalConversions: groupLeads.filter(l => l.status === 'converted').length,
          memberStats: group.members.map(member => ({
            ...member,
            calls: groupLeads.filter(l => l.addedBy === member.id && l.status !== 'not-called').length,
            conversions: groupLeads.filter(l => l.addedBy === member.id && l.status === 'converted').length,
          }))
        };
      };

      const stats = {
        total: leads.length,
        called: leads.filter(l => l.status !== 'not-called').length,
        interested: leads.filter(l => l.status === 'interested').length,
        converted: leads.filter(l => l.status === 'converted').length,
        conversionRate: leads.filter(l => l.status !== 'not-called').length > 0
          ? ((leads.filter(l => l.status === 'converted').length / leads.filter(l => l.status !== 'not-called').length) * 100).toFixed(1)
          : 0,
        myCalls: leads.filter(l => l.addedBy === user?.id && l.status !== 'not-called').length,
        myConversions: leads.filter(l => l.addedBy === user?.id && l.status === 'converted').length,
      };

      const handleSubmit = () => {
        if (!formData.businessName || !formData.contactName || !formData.phone) return;
        const leadData = { 
          ...formData, addedBy: user.id, addedByName: user.name,
          id: editingLead ? editingLead.id : Date.now(),
          date: editingLead ? editingLead.date : new Date().toISOString()
        };
        if (editingLead) {
          setLeads(leads.map(l => l.id === editingLead.id ? leadData : l));
          setEditingLead(null);
        } else {
          setLeads([...leads, leadData]);
        }
        setFormData({ businessName: '', contactName: '', phone: '', email: '', status: 'not-called', notes: '', addedBy: '' });
        setShowAddForm(false);
      };

      const handleEdit = (lead) => {
        setEditingLead(lead);
        setFormData(lead);
        setShowAddForm(true);
      };

      const handleDelete = (id) => {
        if (confirm('Delete this lead?')) setLeads(leads.filter(l => l.id !== id));
      };

      const exportToCSV = () => {
        if (!user?.isPro) return setShowUpgrade(true);
        const headers = ['Business Name', 'Contact Name', 'Phone', 'Email', 'Status', 'Notes', 'Added By', 'Date Added'];
        const rows = leads.map(l => [
          l.businessName, l.contactName, l.phone, l.email, l.status, l.notes,
          l.addedByName || 'Unknown', new Date(l.date).toLocaleDateString()
        ]);
        const csv = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `leads-export-${Date.now()}.csv`;
        a.click();
      };

      const handleStripeCheckout = () => {
        alert('In production: Redirects to Stripe for $5/month payment. For demo, upgrading you now!');
        const updatedUser = { ...user, isPro: true };
        setUser(updatedUser);
        updateUserInStorage(updatedUser);
        setShowUpgrade(false);
      };

      const filteredLeads = leads.filter(lead => {
        const matchesSearch = lead.businessName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                             lead.contactName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                             lead.phone.includes(searchTerm);
        const matchesFilter = filterStatus === 'all' || lead.status === filterStatus;
        return matchesSearch && matchesFilter;
      });

      const getStatusColor = (status) => {
        const colors = {
          'not-called': 'bg-slate-100 text-slate-700',
          'called': 'bg-blue-100 text-blue-700',
          'interested': 'bg-amber-100 text-amber-700',
          'not-interested': 'bg-rose-100 text-rose-700',
          'converted': 'bg-emerald-100 text-emerald-700'
        };
        return colors[status] || 'bg-slate-
